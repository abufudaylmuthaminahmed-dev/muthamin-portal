<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ﬁáﬁ®ﬁêﬁ∞ﬁçﬁßﬁâﬁ∞ ﬁïﬁØﬁìﬁ¶ﬁçﬁ∞</title>
    <!-- Same CSS as before -->
    <style>
       /* ... (Paste previous CSS here) ... */
       /* ADD THIS NEW CSS FOR STATUS */
       .st-done { background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 20px; font-size: 11px; font-weight: bold; }
       .st-fail { background: #fee2e2; color: #991b1b; padding: 4px 8px; border-radius: 20px; font-size: 11px; font-weight: bold; }
       .st-fix { background: #fef9c3; color: #854d0e; padding: 4px 8px; border-radius: 20px; font-size: 11px; font-weight: bold; }
       .st-pending { background: #e0f2f1; color: #00695c; padding: 4px 8px; border-radius: 20px; font-size: 11px; font-weight: bold; }
    </style>
</head>
<body>
    <!-- (HTML Body Structure same as before) -->
    <!-- ... -->

<script type="module">
    // ... (Imports & Config) ...

    function loadDashboard(s) {
        // ... (Header code) ...

        let html = '<div style="padding:20px;">';
        
        // --- WEEKLY WORK LOGIC UPDATED ---
        html += `<div class="result-section-title">ﬁÄﬁ¶ﬁäﬁ∞ﬁåﬁßﬁéﬁ¨ ﬁâﬁ¶ﬁêﬁ¶ﬁáﬁ∞ﬁÜﬁ¶ﬁåﬁ∞</div><div style="max-height:350px; overflow-y:auto; padding-right:5px;">`;
        
        for(let i=45; i>=1; i--) { 
            let submission = s.submissions && s.submissions['Week'+i];
            let status = s['Week'+i]; // Teacher's entry
            let actionArea = '', itemClass = '';

            // 1. TEACHER MARKED AS DONE
            if(status === 'ﬁÇﬁ®ﬁâﬁ®ﬁäﬁ¶ﬁáﬁ®') {
                itemClass = 'done';
                actionArea = `<span class="st-done">‚úÖ ﬁÇﬁ®ﬁâﬁ®ﬁáﬁ∞ﬁñﬁ¨</span>`;
                if(submission) actionArea += ` <button class="btn-view" onclick="viewWork('Week${i}')">üëÅÔ∏è</button>`;
            } 
            // 2. TEACHER MARKED AS NOT DONE
            else if(status === 'ﬁÇﬁ™ﬁÇﬁ®ﬁâﬁ≠') {
                itemClass = 'incomplete';
                actionArea = `<span class="st-fail">‚ùå ﬁÇﬁ™ﬁÇﬁ®ﬁâﬁ≠</span> <button class="btn-upload" onclick="openUploadModal('Week${i}')">üì∑</button>`;
            }
            // 3. TEACHER MARKED AS INCOMPLETE
            else if(status === 'ﬁäﬁ™ﬁÉﬁ®ﬁÄﬁ¶ﬁâﬁ¶ﬁáﬁ¨ﬁáﬁ∞ ﬁÇﬁ™ﬁàﬁ≠') {
                itemClass = 'pending';
                actionArea = `<span class="st-fix">‚ö†Ô∏è ﬁäﬁ™ﬁÉﬁ®ﬁÄﬁ¶ﬁâﬁ¶ﬁáﬁ¨ﬁáﬁ∞ ﬁÇﬁ™ﬁàﬁ≠</span> <button class="btn-upload" onclick="openUploadModal('Week${i}')">üì∑</button>`;
            }
            // 4. STUDENT SUBMITTED (Waiting for Teacher)
            else if(submission) {
                itemClass = 'pending';
                actionArea = `<span class="st-pending">‚è≥ ﬁóﬁ¨ﬁÜﬁ∞ﬁÜﬁ™ﬁÉﬁ¶ﬁÇﬁ©</span> <button class="btn-view" onclick="viewWork('Week${i}')">üëÅÔ∏è</button>`;
            }
            // 5. NO STATUS (Show Upload)
            else {
                actionArea += `<button class="btn-upload" onclick="openUploadModal('Week${i}')">üì∑ ﬁäﬁÆﬁìﬁØﬁçﬁßﬁÇﬁ∞</button>`;
            }

            // Show item logic
            if(status || submission || i < 5) {
                 html += `<div class="result-item ${itemClass}">
                            <div><span style="font-weight:bold; color:#334155;">Week ${i}</span>
                            ${s['Week'+i+'_note'] ? `<div style="font-size:13px; color:#64748b; margin-top:2px;">"${s['Week'+i+'_note']}"</div>`:''}</div>
                            <div style="text-align:right; display:flex; flex-direction:column; align-items:flex-end; gap:5px;">${actionArea}</div>
                         </div>`;
            }
        }
        html += `</div>`; // End Weekly

        // ... (Rest of code for Exams, etc.) ...
        document.getElementById('resultsArea').innerHTML = html;
    }
    
    // ... (Rest of JS) ...
</script>
</body>
</html>
