<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ﬁáﬁ®ﬁêﬁ∞ﬁçﬁßﬁâﬁ∞ ﬁïﬁØﬁìﬁ¶ﬁçﬁ∞</title>
    <style>
        @font-face { font-family: 'Faruma'; src: local('Faruma'), url('https://fonts.cdnfonts.com/s/73114/Faruma.woff') format('woff'); }
        * { font-family: "Faruma", sans-serif; box-sizing: border-box; }
        body { background-color: #f0f4f8; margin: 0; padding: 10px; text-align: right; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 15px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
        h1 { color: #00796b; text-align: center; font-size: 1.6rem; margin-bottom: 20px; font-weight: bold; }
        
        /* Optimized Tabs */
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; background: #e0f2f1; padding: 5px; border-radius: 12px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: bold; font-size: 15px; color: #00695c; border-radius: 8px; transition: 0.2s; }
        .tab-btn.active { background: #fff; color: #004d40; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .card { border: 1px solid #eee; padding: 15px; border-radius: 12px; margin-bottom: 15px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        
        /* Inputs & Buttons */
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; text-align: center; background: #fafafa; }
        input:focus, select:focus { border-color: #00796b; outline: none; background: #fff; }
        
        .btn { width: 100%; padding: 14px; background: #00796b; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.1s; }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #cfd8dc; color: #78909c; }
        
        /* Optimized Table */
        .table-container { width: 100%; overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid #eee; background: white; -webkit-overflow-scrolling: touch; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #e0f2f1; color: #004d40; padding: 12px; font-size: 14px; position: sticky; top: 0; z-index: 10; font-weight: bold; }
        td { padding: 10px; border-bottom: 1px solid #f0f0f0; text-align: center; font-size: 14px; }
        
        /* Custom Inputs */
        .v-in { width: 100% !important; font-weight: bold; border: 1px solid #b2dfdb !important; background: #fdfdfd; padding: 8px; border-radius: 6px; }
        .v-in:focus { border: 2px solid #00796b !important; }
        .n-in { text-align: right; font-size: 13px; }

        /* Filter Pills */
        .pills { display: flex; gap: 6px; overflow-x: auto; padding: 5px 0; margin-bottom: 10px; scrollbar-width: none; }
        .pills::-webkit-scrollbar { display: none; }
        .pill { padding: 8px 16px; background: #f5f5f5; border-radius: 20px; cursor: pointer; white-space: nowrap; font-size: 13px; color: #555; border: 1px solid #eee; }
        .pill.active { background: #00796b; color: white; border-color: #00796b; font-weight: bold; }

        /* Floating Save Button */
        .fab-save { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #2e7d32; color: white; padding: 12px 30px; border-radius: 50px; border: none; font-size: 16px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.25); z-index: 1000; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
        .fab-save:active { transform: translateX(-50%) scale(0.95); }

        /* Loader */
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #00796b; border-radius: 50%; width: 24px; height: 24px; animation: spin 0.8s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Badges */
        .grade-badge { padding: 4px 8px; border-radius: 6px; font-weight: bold; color: white; font-size: 12px; display: inline-block; min-width: 30px; }
        .g-A-star { background: #fbc02d; color: #333; } .g-A { background: #43a047; } .g-B { background: #1976d2; }
        .g-C { background: #f57c00; } .g-Fail { background: #d32f2f; }
        
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #323232; color: white; padding: 10px 20px; border-radius: 5px; font-size: 14px; opacity: 0; transition: 0.3s; pointer-events: none; z-index: 2000; }
        .toast.show { opacity: 1; bottom: 90px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üåô ﬁáﬁ®ﬁêﬁ∞ﬁçﬁßﬁâﬁ∞ ﬁïﬁØﬁìﬁ¶ﬁçﬁ∞</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('parent')">ﬁÑﬁ¨ﬁçﬁ¨ﬁÇﬁ®ﬁàﬁ¨ﬁÉﬁ®ﬁÇﬁ∞</button>
        <button class="tab-btn" onclick="switchTab('teacher')">ﬁâﬁ™ﬁãﬁ¶ﬁáﬁ∞ﬁÉﬁ®ﬁêﬁ™ﬁÇﬁ∞</button>
    </div>

    <!-- Parent View -->
    <div id="parentView">
        <div class="card">
            <input type="number" id="pIdx" placeholder="ﬁáﬁ®ﬁÇﬁ∞ﬁëﬁ¨ﬁÜﬁ∞ﬁêﬁ∞ ﬁÇﬁ¶ﬁÇﬁ∞ﬁÑﬁ¶ﬁÉﬁ™" inputmode="numeric">
            <button class="btn" onclick="searchStudent()">ﬁÑﬁ¶ﬁçﬁßﬁçﬁ™ﬁâﬁ¶ﬁÅﬁ∞</button>
        </div>
        <div id="pRes" class="card" style="display:none;"></div>
    </div>

    <!-- Teacher View -->
    <div id="teacherView" style="display:none;">
        <div id="loginArea" class="card">
            <h3 style="text-align:center; margin-top:0;">ﬁçﬁÆﬁéﬁ®ﬁÇﬁ∞</h3>
            <input type="password" id="pass" placeholder="ﬁïﬁßﬁêﬁ∞ﬁàﬁØﬁëﬁ∞">
            <button class="btn" onclick="login()">ﬁçﬁÆﬁéﬁ®ﬁÇﬁ∞</button>
        </div>

        <div id="teacherPanel" style="display:none;">
            <div class="pills">
                <div class="pill active" id="m_work" onclick="setMode('work')">ﬁÄﬁ¶ﬁäﬁ∞ﬁåﬁß</div>
                <div class="pill" id="m_test" onclick="setMode('test')">ﬁîﬁ™ﬁÇﬁ®ﬁìﬁ∞ ﬁìﬁ¨ﬁêﬁ∞ﬁìﬁ∞</div>
                <div class="pill" id="m_ca" onclick="setMode('ca')">CA</div>
            </div>
            
            <div class="card" style="padding:12px;">
                <div style="display:flex; gap:10px;">
                    <div style="flex:1">
                        <small style="color:#666; font-weight:bold;">ﬁáﬁ¶ﬁáﬁ®ﬁìﬁ¶ﬁâﬁ∞:</small>
                        <select id="itemSelect" onchange="renderTeacherTable()"></select>
                    </div>
                    <div id="totalDiv" style="width:90px; display:none;">
                        <small style="color:#666; font-weight:bold;">Out of:</small>
                        <input type="number" id="totalMarks" value="20" style="padding:8px;" oninput="renderTeacherTable()">
                    </div>
                </div>
                
                <div style="margin-top:8px;">
                    <div id="gradeFilter" class="pills"></div>
                    <div id="classFilter" class="pills"></div>
                </div>
                
                <div style="text-align:right;">
                    <button onclick="fetchData(true)" style="background:none; border:none; color:#00695c; font-size:13px; cursor:pointer; padding:5px;">üîÑ Refresh Data</button>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width:50px">ID</th>
                            <th>Name</th>
                            <th id="valHead">Status</th>
                            <th id="thG" style="width:60px; display:none;">%</th>
                            <th>Note</th>
                        </tr>
                    </thead>
                    <tbody id="tBody"></tbody>
                </table>
            </div>
            
            <div style="height: 60px;"></div> <!-- Spacer for FAB -->
            <button id="sBtn" class="fab-save" onclick="saveData()">
                üíæ ﬁêﬁ≠ﬁàﬁ∞ﬁÜﬁ™ﬁÉﬁ≠
            </button>
        </div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
    // URL
    const API_URL = "https://script.google.com/macros/s/AKfycbw-5ADduWaMX-SZkbNd2d7qF0Hm7oX1EeO4-MHFQ4Oe-LVecdB-XipYvLsC0eD7WIJp/exec";
    
    let db = [];
    let mode = 'work';
    let selGrade = 'All';
    let selClass = 'All';

    // Local Storage Key
    const CACHE_KEY = 'islam_portal_db_v1';

    function init() {
        // Load cached data immediately if available
        const cached = localStorage.getItem(CACHE_KEY);
        if (cached) {
            try {
                db = JSON.parse(cached);
            } catch(e) {}
        }
    }
    init();

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    function switchTab(t) {
        document.getElementById('parentView').style.display = t=='parent'?'block':'none';
        document.getElementById('teacherView').style.display = t=='teacher'?'block':'none';
        document.querySelectorAll('.tab-btn').forEach((b,i)=>b.classList.toggle('active', (i==0&&t=='parent')||(i==1&&t=='teacher')));
    }

    function login() {
        if(document.getElementById('pass').value == "123") {
            document.getElementById('loginArea').style.display='none';
            document.getElementById('teacherPanel').style.display='block';
            
            // If we have cached data, show it immediately
            if(db.length > 0) {
                setMode(mode);
                updateFilters();
                // Fetch fresh data in background
                fetchData(false);
            } else {
                fetchData(true);
            }
        } else alert("ﬁïﬁßﬁêﬁ∞ﬁàﬁØﬁëﬁ∞ ﬁÇﬁ™ﬁÑﬁ¶ﬁáﬁ®");
    }

    function fetchData(showLoader = true) {
        if(showLoader) document.getElementById('tBody').innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;"><div class="loader"></div> ﬁçﬁØﬁëﬁ∞ ﬁàﬁ¶ﬁÇﬁ©...</td></tr>';
        
        const cb = 'cb'+Date.now();
        window[cb] = (data) => {
            db = data;
            // Update cache
            localStorage.setItem(CACHE_KEY, JSON.stringify(db));
            
            setMode(mode);
            updateFilters();
            if(!showLoader) showToast("ﬁëﬁ≠ﬁìﬁß ﬁáﬁ¶ﬁïﬁ∞ﬁëﬁ≠ﬁìﬁ∞ ﬁàﬁ¨ﬁáﬁ∞ﬁñﬁ¨");
            delete window[cb];
        };
        const s = document.createElement('script');
        s.src = `${API_URL}?prefix=${cb}&action=read&t=${Date.now()}`; // Add timestamp to avoid caching URL
        document.body.appendChild(s);
    }

    function updateFilters() {
        const grades = [...new Set(db.map(x=>x.Grade))].filter(Boolean).sort();
        let html = `<div class="pill ${selGrade=='All'?'active':''}" onclick="selGrade='All';selClass='All';updateFilters();renderTable()">All</div>`;
        grades.forEach(g => {
            html += `<div class="pill ${selGrade==g?'active':''}" onclick="selGrade='${g}';selClass='All';updateFilters();renderTable()">Gr ${g}</div>`;
        });
        document.getElementById('gradeFilter').innerHTML = html;

        // Class filters based on selected grade
        let cHtml = '';
        if(selGrade !== 'All') {
            const classes = [...new Set(db.filter(x=>x.Grade==selGrade).map(x=>x.Class))].filter(Boolean).sort();
            cHtml = `<div class="pill ${selClass=='All'?'active':''}" onclick="selClass='All';renderTable()">All Classes</div>`;
            classes.forEach(c => {
                cHtml += `<div class="pill ${selClass==c?'active':''}" onclick="selClass='${c}';renderTable()">${c}</div>`;
            });
        }
        document.getElementById('classFilter').innerHTML = cHtml;
    }

    function setMode(m) {
        mode = m;
        document.querySelectorAll('.mode-pills .pill').forEach(p=>p.classList.remove('active')); // Note: pills class logic handled in HTML
        document.querySelectorAll('#m_work, #m_test, #m_ca').forEach(p=>p.classList.remove('active'));
        document.getElementById('m_'+m).classList.add('active');
        
        let sel = document.getElementById('itemSelect');
        let currentVal = sel.value;
        sel.innerHTML = "";
        
        if(m=='work') for(let i=1;i<=45;i++) sel.innerHTML += `<option value="Week ${i}">Week ${i}</option>`;
        if(m=='test') for(let i=1;i<=10;i++) sel.innerHTML += `<option value="Unit Test ${i}">Unit Test ${i}</option>`;
        if(m=='ca') for(let i=1;i<=4;i++) sel.innerHTML += `<option value="CA ${i}">CA ${i}</option>`;
        
        // Try to keep selection if switching back
        // if(currentVal && sel.querySelector(`option[value="${currentVal}"]`)) sel.value = currentVal;
        
        document.getElementById('totalDiv').style.display = m=='work'?'none':'flex';
        document.getElementById('thG').style.display = m=='work'?'none':'table-cell';
        document.getElementById('valHead').innerText = m=='work'?'ﬁÄﬁßﬁçﬁ¶ﬁåﬁ™':'ﬁâﬁßﬁÜﬁ∞ﬁêﬁ∞';
        renderTable();
    }

    function findVal(student, key) {
        let cleanKey = key.toLowerCase().replace(/\s/g, '');
        return student[key] || student[cleanKey] || "";
    }

    function renderTable() {
        const item = document.getElementById('itemSelect').value;
        const total = document.getElementById('totalMarks').value || 100;
        let num = item.replace(/\D/g, '');
        let noteKey = mode=='work' ? 'Note'+num : (mode=='test'?'TNote'+num:'CANote'+num);

        let filtered = db;
        if(selGrade !== 'All') filtered = filtered.filter(x => x.Grade == selGrade);
        if(selClass !== 'All') filtered = filtered.filter(x => x.Class == selClass);
        
        // Performance: render only first 100 rows if too many to avoid UI freeze
        // or just render all since it's local
        let html = "";
        if(filtered.length === 0) {
            document.getElementById('tBody').innerHTML = "<tr><td colspan='5'>ﬁÇﬁ¶ﬁåﬁ©ﬁñﬁßﬁáﬁ¨ﬁáﬁ∞ ﬁÇﬁ¨ﬁåﬁ∞</td></tr>";
            return;
        }

        filtered.forEach(s => {
            let val = findVal(s, item);
            let n = findVal(s, noteKey);
            
            let input = mode=='work' 
                ? `<select class="v-in" data-idx="${s.Index}"><option value="">-</option><option value="ﬁÇﬁ®ﬁâﬁ®ﬁäﬁ¶ﬁáﬁ®" ${val=='ﬁÇﬁ®ﬁâﬁ®ﬁäﬁ¶ﬁáﬁ®'?'selected':''}>ﬁÇﬁ®ﬁâﬁ®ﬁäﬁ¶ﬁáﬁ®</option><option value="ﬁÇﬁ™ﬁÇﬁ®ﬁâﬁ≠" ${val=='ﬁÇﬁ™ﬁÇﬁ®ﬁâﬁ≠'?'selected':''}>ﬁÇﬁ™ﬁÇﬁ®ﬁâﬁ≠</option><option value="ﬁäﬁ™ﬁÉﬁ®ﬁÄﬁ¶ﬁâﬁ¶ﬁáﬁ¨ﬁáﬁ∞ ﬁÇﬁ™ﬁàﬁ≠" ${val=='ﬁäﬁ™ﬁÉﬁ®ﬁÄﬁ¶ﬁâﬁ¶ﬁáﬁ¨ﬁáﬁ∞ ﬁÇﬁ™ﬁàﬁ≠'?'selected':''}>ﬁäﬁ™ﬁÉﬁ®ﬁÄﬁ¶ﬁâﬁ¶ ﬁÇﬁ™ﬁàﬁ≠</option></select>`
                : `<input type="number" class="v-in" data-idx="${s.Index}" value="${val}" style="width:60px" oninput="calcRow(this, ${total})">`;
            
            let gradeHtml = "";
            if(mode !== 'work') {
                let p = val ? Math.round((val/total)*100) : 0;
                let cls = p>=90?'g-A-star':(p>=80?'g-A':(p>=70?'g-B':(p>=60?'g-C':'g-Fail')));
                let lbl = p>=90?'A*':(p>=80?'A':(p>=70?'B':(p>=60?'C':'Fail')));
                gradeHtml = val ? `<span class="grade-badge ${cls}">${lbl}</span><br><small>${p}%</small>` : '-';
            }

            html += `<tr>
                <td><b>${s.Index}</b></td>
                <td style="text-align:right">${s.Name}<br><small style="color:#888">${s.Grade} ${s.Class}</small></td>
                <td>${input}</td>
                ${mode!='work' ? `<td id="g-${s.Index}">${gradeHtml}</td>` : ''}
                <td><input type="text" class="n-in" data-idx="${s.Index}" value="${n}" placeholder="..."></td>
            </tr>`;
        });
        document.getElementById('tBody').innerHTML = html;
    }

    function calcRow(el, t) {
        let v = el.value;
        let p = v ? Math.round((v/t)*100) : 0;
        let cls = p>=90?'g-A-star':(p>=80?'g-A':(p>=70?'g-B':(p>=60?'g-C':'g-Fail')));
        let lbl = p>=90?'A*':(p>=80?'A':(p>=70?'B':(p>=60?'C':'Fail')));
        document.getElementById('g-'+el.dataset.idx).innerHTML = v ? `<span class="grade-badge ${cls}">${lbl}</span><br><small>${p}%</small>` : '';
    }

    async function saveData() {
        const btn = document.getElementById('sBtn');
        const item = document.getElementById('itemSelect').value;
        const total = document.getElementById('totalMarks').value;
        
        btn.disabled = true; btn.innerHTML = '<div class="loader"></div>';
        
        const updates = Array.from(document.querySelectorAll('.v-in')).map((el, i) => ({
            index: el.dataset.idx,
            val: el.value,
            note: document.querySelectorAll('.n-in')[i].value
        }));

        // Optimistic UI Update: Update local DB immediately
        let num = item.replace(/\D/g, '');
        let noteKey = mode === 'week' ? 'Note'+num : (mode === 'unit' ? 'TNote'+num : 'CANote'+num);
        let cleanItemKey = item.toLowerCase().replace(/\s/g, '');
        
        updates.forEach(u => {
             const s = db.find(x => x.Index.toString() === u.index.toString());
             if(s) {
                 s[item] = u.val; // Store with Original Key for display
                 s[cleanItemKey] = u.val; // Store with Clean key just in case
                 s[noteKey] = u.note;
             }
        });
        // Save to cache so if they reload, it's still there
        localStorage.setItem(CACHE_KEY, JSON.stringify(db));
        
        showToast("ﬁâﬁ¶ﬁ¢ﬁ™ﬁçﬁ´ﬁâﬁßﬁåﬁ™ ﬁàﬁ¶ﬁéﬁ™ﬁåﬁ©ﬁéﬁÆﬁåﬁ™ﬁÇﬁ∞ ﬁêﬁ≠ﬁàﬁ∞ﬁàﬁ¨ﬁáﬁ∞ﬁñﬁ¨...");

        // Send to Server
        try {
            const p = new URLSearchParams({ action:'save', item:item, mode:mode, updates:JSON.stringify(updates) });
            await fetch(`${API_URL}?${p.toString()}`, { mode:'no-cors' });
            showToast("‚úÖ ﬁêﬁßﬁàﬁ¶ﬁÉﬁ¶ﬁÅﬁ∞ ﬁäﬁÆﬁÇﬁ™ﬁàﬁ®ﬁáﬁ∞ﬁñﬁ¨!");
        } catch(e) { 
            showToast("‚ùå ﬁâﬁ¶ﬁáﬁ∞ﬁêﬁ¶ﬁçﬁ¶ﬁáﬁ¨ﬁáﬁ∞ ﬁñﬁ¨ﬁÄﬁ®ﬁáﬁ∞ﬁñﬁ¨ (ﬁáﬁ®ﬁÇﬁ∞ﬁìﬁ¶ﬁÇﬁ¨ﬁìﬁ∞ ﬁóﬁ¨ﬁÜﬁ∞ﬁÜﬁ™ﬁÉﬁ¶ﬁáﬁ∞ﬁàﬁß)"); 
        }
        btn.disabled = false; btn.innerHTML = "üíæ ﬁêﬁ≠ﬁàﬁ∞ﬁÜﬁ™ﬁÉﬁ≠";
    }

    function searchStudent() {
        const idx = document.getElementById('pIdx').value;
        if(!idx) return;
        const res = document.getElementById('pRes');
        res.innerHTML = '<div style="text-align:center"><div class="loader"></div></div>'; res.style.display = 'block';

        // Check local cache first for parent too if available, otherwise fetch
        // Parent view usually doesn't load full DB, but let's fetch specific student
        const cb = 's'+Date.now();
        window[cb] = (data) => {
            const s = data.find(x => String(x.Index) === String(idx));
            if(s) {
                let h = `<div style="text-align:center; margin-bottom:15px;"><h2 style="color:#00796b; margin:0;">${s.Name}</h2><p style="color:#666">${s.Grade} ${s.Class} | Index: ${s.Index}</p></div>`;
                
                // Table generator helper
                const mkTab = (title, pre, max, isMk) => {
                    let r = "";
                    for(let i=1; i<=max; i++) {
                        let k = pre + (pre.includes('Test')?' '+i:i); // Handle space in "Unit Test 1"
                        let v = findVal(s, k);
                        // Try various note keys
                        let n = findVal(s, (pre=='Week'?'Note':'TNote')+i) || findVal(s, (pre=='CA'?'CANote':(pre.includes('Test')?'TNote':'Note'))+i);
                        
                        if(v) {
                            let xtra = "";
                            if(isMk) {
                                let p = calculatePercentage(v, 20); // Assuming 20 for parent view, or could just show marks
                                // Since we don't know total marks here easily without storing it, we just show raw or simple grade
                                let g = calcGrade(v, 20); // Default to 20
                                xtra = `<span class="grade-badge ${g.cls}">${g.lbl}</span>`;
                            }
                            r += `<tr><td style="text-align:right; width:40%;">${k}</td><td><b>${v}</b> ${xtra}<div style="font-size:12px; color:#555; margin-top:2px;">${n}</div></td></tr>`;
                        }
                    }
                    return r ? `<tr><th colspan="2">${title}</th></tr>` + r : "";
                };

                let t = "<table>";
                t += mkTab("ﬁÄﬁ¶ﬁäﬁ∞ﬁåﬁßﬁéﬁ¨ ﬁâﬁ¶ﬁêﬁ¶ﬁáﬁ∞ﬁÜﬁ¶ﬁåﬁ∞", "Week", 45, false);
                t += mkTab("ﬁîﬁ™ﬁÇﬁ®ﬁìﬁ∞ ﬁìﬁ¨ﬁêﬁ∞ﬁìﬁ∞ (20)", "Unit Test", 10, true);
                t += mkTab("ﬁÜﬁ∞ﬁçﬁßﬁêﬁ∞ ﬁáﬁ¨ﬁêﬁ¨ﬁêﬁ∞ﬁâﬁ¨ﬁÇﬁ∞ﬁìﬁ∞", "CA", 4, true);
                t += "</table>";

                res.innerHTML = h + (t === "<table></table>" ? "<p>ﬁâﬁ¶ﬁ¢ﬁ™ﬁçﬁ´ﬁâﬁßﬁåﬁ¨ﬁáﬁ∞ ﬁÇﬁ™ﬁäﬁ¨ﬁÇﬁ™ﬁÇﬁ™</p>" : t);
            } else res.innerHTML = "<p style='color:red; text-align:center'>ﬁãﬁ¶ﬁÉﬁ®ﬁàﬁ¶ﬁÉﬁ™ ﬁÇﬁ™ﬁäﬁ¨ﬁÇﬁ™ﬁÇﬁ™</p>";
            delete window[cb];
        };
        const sc = document.createElement('script');
        sc.src = `${API_URL}?prefix=${cb}&action=read&t=${Date.now()}`;
        document.body.appendChild(sc);
    }
    
    function calculatePercentage(marks, fullMarks) {
        return Math.round((parseFloat(marks) / parseFloat(fullMarks)) * 100);
    }
</script>
</body>
</html>
